<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blockchain Fair Lottery</title>
    <link rel="stylesheet" href="stylescss">
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <style>
        body {
    font-family: Arial, sans-serif;
    background-color: #f8f9fa;
    text-align: center;
    padding: 20px;
}

.container {
    max-width: 600px;
    margin: auto;
    background: white;
    padding: 20px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    border-radius: 10px;
}

.tabs {
    display: flex;
    justify-content: space-around;
    margin-bottom: 20px;
}

.tab-button {
    padding: 10px 20px;
    cursor: pointer;
    border: none;
    background: #007bff;
    color: white;
    border-radius: 5px;
}

.tab-button.active {
    background: #0056b3;
}

.lottery-panel {
    display: none;
}

.lottery-panel.active {
    display: block;
}

button {
    margin: 10px;
    padding: 10px 15px;
    border: none;
    background: #28a745;
    color: white;
    border-radius: 5px;
    cursor: pointer;
}

button:hover {
    background: #218838;
}

#status {
    margin-top: 20px;
    font-weight: bold;
}
    </style>
</head>
<body>
    <div class="container">
        <h1>Blockchain Fair Lottery</h1>
        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('daily')">Lotre Harian</button>
            <button class="tab-button" onclick="switchTab('weekly')">Lotre Mingguan</button>
            <button class="tab-button" onclick="switchTab('monthly')">Lotre Bulanan</button>
        </div>

        <div id="daily" class="lottery-panel active">
            <h2>Lotre Harian</h2>
            <p>Harga Tiket: 1.5 USDT</p>
            <button onclick="buyTicket('daily')">Beli Tiket</button>
            <button onclick="revealNumber('daily')">Ungkap Nomor</button>
        </div>

        <div id="weekly" class="lottery-panel">
            <h2>Lotre Mingguan</h2>
            <p>Harga Tiket: 5 USDT</p>
            <button onclick="buyTicket('weekly')">Beli Tiket</button>
            <button onclick="revealNumber('weekly')">Ungkap Nomor</button>
        </div>

        <div id="monthly" class="lottery-panel">
            <h2>Lotre Bulanan</h2>
            <p>Harga Tiket: 10 USDT</p>
            <button onclick="buyTicket('monthly')">Beli Tiket</button>
            <button onclick="revealNumber('monthly')">Ungkap Nomor</button>
        </div>

        <p id="status"></p>
    </div>
    
    <script src="scriptjs"></script>
    <script>
        const contractAddress = "0xYourSmartContractAddress"; // Ganti dengan alamat kontrak
const usdtAddress = "0xYourUSDTTokenAddress"; // Ganti dengan alamat USDT ERC-20
const abi = [ /* Masukkan ABI kontrak di sini */ ];

let web3;
let contract;
let account;

// Fungsi untuk mengganti tab
function switchTab(tabName) {
    document.querySelectorAll('.lottery-panel').forEach(panel => {
        panel.classList.remove('active');
    });
    document.querySelector(`#${tabName}`).classList.add('active');

    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
    });
    document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
}

// Inisialisasi Web3
async function initWeb3() {
    if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        await window.ethereum.request({ method: "eth_requestAccounts" });
        const accounts = await web3.eth.getAccounts();
        account = accounts[0];
        contract = new web3.eth.Contract(abi, contractAddress);
        document.getElementById("status").innerText = `Terhubung: ${account}`;
    } else {
        alert("MetaMask tidak ditemukan. Harap install terlebih dahulu.");
    }
}

// Fungsi untuk membeli tiket
async function buyTicket(lotteryType) {
    if (!account) await initWeb3();

    let price;
    if (lotteryType === "daily") price = web3.utils.toWei("1.5", "ether");
    if (lotteryType === "weekly") price = web3.utils.toWei("5", "ether");
    if (lotteryType === "monthly") price = web3.utils.toWei("10", "ether");

    const usdtContract = new web3.eth.Contract([
        { "constant": false, "inputs": [{ "name": "spender", "type": "address" }, { "name": "value", "type": "uint256" }], "name": "approve", "outputs": [{ "name": "", "type": "bool" }], "type": "function" }
    ], usdtAddress);

    // Setujui transfer USDT ke kontrak
    await usdtContract.methods.approve(contractAddress, price).send({ from: account });

    // Komit nomor lotre dengan hash random
    const randomNumber = Math.floor(Math.random() * 1000000);
    const salt = web3.utils.randomHex(32);
    const commitment = web3.utils.soliditySha3(salt, randomNumber);

    await contract.methods.buyTicket(lotteryType, commitment).send({ from: account });

    document.getElementById("status").innerText = "Tiket berhasil dibeli!";
}

// Fungsi untuk mengungkap nomor lotre
async function revealNumber(lotteryType) {
    if (!account) await initWeb3();

    const randomNumber = prompt("Masukkan nomor lotre yang Anda ingat:");
    const salt = prompt("Masukkan salt yang digunakan:");

    if (!randomNumber || !salt) {
        alert("Anda harus mengisi nomor dan salt!");
        return;
    }

    await contract.methods.revealNumber(lotteryType, randomNumber, salt).send({ from: account });

    document.getElementById("status").innerText = "Nomor berhasil diungkap!";
}

// Inisialisasi saat halaman dimuat
window.onload = initWeb3;
    </script>
</body>
</html>
