<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DApps Fair Lottery</title>
    <link rel="stylesheet" href="stylecss">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.8.0/web3.min.js"></script>
    <style>
        body {
    font-family: Arial, sans-serif;
    text-align: center;
    background-color: #f4f4f4;
}

header {
    background: #333;
    color: white;
    padding: 10px;
}

button {
    padding: 10px;
    margin: 5px;
    cursor: pointer;
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
}

.modal-content {
    background: white;
    padding: 20px;
    width: 300px;
    margin: 100px auto;
}
    </style>
</head>
<body>

    <!-- Header -->
    <header>
        <h1>DApps Fair Lottery</h1>
        <button id="connectWalletBtn" onclick="connectWallet()">Connect Wallet</button>
        <button id="disconnectWalletBtn" onclick="disconnectWallet()" style="display: none;">Disconnect</button>
        <p>Wallet: <span id="walletAddress">Not Connected</span></p>
    </header>

    <!-- Saldo & Tiket -->
    <section class="balance-info">
        <p>Saldo USDT: <span id="usdtBalance">0</span> USDT</p>
        <p>Tiket Dibeli: <span id="ticketCount">0</span></p>
    </section>

    <!-- Pilihan Lotre -->
    <section class="lottery-tabs">
        <button onclick="showLottery('daily')">Lotre Harian</button>
        <button onclick="showLottery('weekly')">Lotre Mingguan</button>
        <button onclick="showLottery('monthly')">Lotre Bulanan</button>
    </section>

    <!-- Detail Lotre -->
    <section id="lotteryDetails">
        <h2 id="lotteryTitle">Lotre Harian</h2>
        <p>Harga Tiket: <span id="ticketPrice">1.5</span> USDT</p>
        <p>Waktu Undian: <span id="countdown">00:00:00</span></p>
        <button onclick="openBuyModal()">Beli Tiket</button>
    </section>

    <!-- Modal Pembelian Tiket -->
    <div id="buyModal" class="modal">
        <div class="modal-content">
            <h2>Beli Tiket</h2>
            <label>Jumlah Tiket:</label>
            <input type="number" id="ticketAmount" min="1" max="100" value="1">
            <p>Total Biaya: <span id="totalCost">1.5</span> USDT</p>
            <button onclick="buyTicket()">Buy</button>
            <button onclick="closeBuyModal()">Cancel</button>
        </div>
    </div>

    <!-- Hasil Undian -->
    <section id="winners">
        <h2>Pemenang</h2>
        <p>Juara 1: <span id="winner1">-</span></p>
        <p>Juara 2: <span id="winner2">-</span></p>
        <p>Juara 3: <span id="winner3">-</span></p>
    </section>

    <script src="scriptjs"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
    const contractAddress = "0x123456789abcdef"; // Ganti dengan alamat kontrak asli
    const contractABI = [...]; // Tambahkan ABI smart contract asli

    let web3;
    let lotteryContract;
    let account;

    // Pastikan semua tombol bisa diklik
    document.getElementById("connectWalletBtn").addEventListener("click", connectWallet);
    document.getElementById("disconnectWalletBtn").addEventListener("click", disconnectWallet);
    document.getElementById("buyModal").addEventListener("click", closeBuyModal);
    document.querySelector(".modal-content").addEventListener("click", function (e) {
        e.stopPropagation(); // Mencegah modal tertutup saat klik di dalamnya
    });

    // Koneksi Wallet
    async function connectWallet() {
        if (window.ethereum) {
            web3 = new Web3(window.ethereum);
            await window.ethereum.request({ method: "eth_requestAccounts" });
            const accounts = await web3.eth.getAccounts();
            account = accounts[0];

            lotteryContract = new web3.eth.Contract(contractABI, contractAddress);

            document.getElementById("walletAddress").innerText = account;
            document.getElementById("connectWalletBtn").style.display = "none";
            document.getElementById("disconnectWalletBtn").style.display = "block";

            updateBalance();
        } else {
            alert("MetaMask tidak ditemukan.");
        }
    }

    // Diskoneksi Wallet
    function disconnectWallet() {
        account = null;
        document.getElementById("walletAddress").innerText = "Not Connected";
        document.getElementById("connectWalletBtn").style.display = "block";
        document.getElementById("disconnectWalletBtn").style.display = "none";
    }

    // Update Saldo USDT
    async function updateBalance() {
        if (!account || !lotteryContract) return;
        let balance = await lotteryContract.methods.getBalance(account).call();
        document.getElementById("usdtBalance").innerText = balance;
    }

    // Buka Modal Beli Tiket
    function openBuyModal() {
        document.getElementById("buyModal").style.display = "block";
    }

    // Tutup Modal
    function closeBuyModal() {
        document.getElementById("buyModal").style.display = "none";
    }

    // Perbarui Total Biaya Saat Jumlah Tiket Berubah
    document.getElementById("ticketAmount").addEventListener("input", function () {
        let amount = parseInt(this.value) || 0;
        let price = parseFloat(document.getElementById("ticketPrice").innerText);
        document.getElementById("totalCost").innerText = (amount * price).toFixed(2);
    });

    // Beli Tiket
    async function buyTicket() {
        if (!account || !lotteryContract) {
            alert("Harap sambungkan wallet terlebih dahulu!");
            return;
        }

        let amount = document.getElementById("ticketAmount").value;
        if (amount < 1 || amount > 100) {
            alert("Jumlah tiket harus antara 1 hingga 100!");
            return;
        }

        await lotteryContract.methods.buyTicket(amount).send({ from: account });
        alert("Tiket berhasil dibeli!");
        closeBuyModal();
        updateBalance();
    }

    // Countdown Lotre
    function startCountdown() {
        let time = 86400; // 24 jam contoh
        setInterval(() => {
            let hours = Math.floor(time / 3600);
            let minutes = Math.floor((time % 3600) / 60);
            let seconds = time % 60;
            document.getElementById("countdown").innerText = `${hours}:${minutes}:${seconds}`;
            time--;
        }, 1000);
    }

    // Ambil Pemenang
    async function fetchWinners() {
        if (!lotteryContract) return;
        let winners = await lotteryContract.methods.getWinners().call();
        document.getElementById("winner1").innerText = winners[0] || "-";
        document.getElementById("winner2").innerText = winners[1] || "-";
        document.getElementById("winner3").innerText = winners[2] || "-";
    }

    // Jalankan saat halaman siap
    startCountdown();
});
    </script>
</body>
</html>
