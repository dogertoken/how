<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TotoChain</title>
    <link rel="stylesheet" href="stylescss">
    <style>
      body {
    font-family: Arial, sans-serif;
    background-color: #f0f0f0;
    padding: 20px;
}

.wallet-container, .bet-container, .history-container, .public-history-container, .comments-container {
    background-color: white;
    padding: 20px;
    margin: 20px 0;
    border-radius: 8px;
    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
}

button {
    background-color: #4CAF50;
    color: white;
    padding: 10px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
}

button:hover {
    background-color: #45a049;
}

input, textarea {
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    border-radius: 5px;
    border: 1px solid #ddd;
}

h2 {
    margin-bottom: 20px;
}
    </style>
</head>
<body>
    <div class="wallet-container">
        <button id="connect-wallet-btn">Connect Wallet</button>
        <button id="disconnect-wallet-btn" style="display:none;">Disconnect Wallet</button>
        <div id="wallet-address"></div>
        <div id="eth-balance"></div>
        <div id="usdt-balance"></div>
    </div>

    <div class="bet-container">
        <h2>Place a Bet</h2>
        <label for="bet-amount">Bet Amount:</label>
        <input type="number" id="bet-amount" />
        <button id="place-bet-btn">Place Bet</button>
    </div>

    <div class="history-container">
        <h2>Your Bet History</h2>
        <div id="personal-bet-history"></div>
    </div>

    <div class="public-history-container">
        <h2>Public Bet History</h2>
        <div id="public-bet-history"></div>
    </div>

    <div class="comments-container">
        <h2>Comments</h2>
        <textarea id="comment-input"></textarea>
        <button id="submit-comment-btn">Submit Comment</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.0.28/dist/ethers.umd.min.js"></script>
    <script src="scriptjs"></script>

    <script>
      let provider;
let signer;
let walletAddress = null;

const connectWalletBtn = document.getElementById('connect-wallet-btn');
const disconnectWalletBtn = document.getElementById('disconnect-wallet-btn');
const walletAddressElement = document.getElementById('wallet-address');
const ethBalanceElement = document.getElementById('eth-balance');
const usdtBalanceElement = document.getElementById('usdt-balance');
const personalBetHistory = document.getElementById('personal-bet-history');
const publicBetHistory = document.getElementById('public-bet-history');

// Koneksi wallet menggunakan Ethers.js
async function connectWallet() {
    if (typeof window.ethereum !== "undefined") {
        provider = new ethers.BrowserProvider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        walletAddress = await signer.getAddress();
        
        walletAddressElement.textContent = `Connected: ${walletAddress}`;
        connectWalletBtn.style.display = "none";
        disconnectWalletBtn.style.display = "inline";
        
        await updateBalance();
        await loadBetHistory();
    } else {
        alert("Please install MetaMask to use this feature.");
    }
}

// Pemutusan koneksi wallet
async function disconnectWallet() {
    walletAddress = null;
    walletAddressElement.textContent = "Not connected";
    connectWalletBtn.style.display = "inline";
    disconnectWalletBtn.style.display = "none";
    ethBalanceElement.textContent = "";
    usdtBalanceElement.textContent = "";
    personalBetHistory.innerHTML = "";
    publicBetHistory.innerHTML = "";
}

// Menampilkan saldo ETH dan USDT
async function updateBalance() {
    // Saldo ETH
    const ethBalance = await provider.getBalance(walletAddress);
    ethBalanceElement.textContent = `ETH Balance: ${ethers.utils.formatEther(ethBalance)} ETH`;

    // Saldo USDT (ERC20 Token)
    const usdtAddress = "USDT_CONTRACT_ADDRESS";  // Ganti dengan alamat kontrak USDT
    const usdtContract = new ethers.Contract(usdtAddress, [
        "function balanceOf(address) view returns (uint256)"
    ], provider);
    const usdtBalance = await usdtContract.balanceOf(walletAddress);
    usdtBalanceElement.textContent = `USDT Balance: ${ethers.utils.formatUnits(usdtBalance, 6)} USDT`;
}

// Fungsi untuk menempatkan taruhan
async function placeBet() {
    if (!walletAddress) {
        alert("Please connect your wallet first.");
        return;
    }

    const betAmount = document.getElementById('bet-amount').value;
    if (!betAmount || betAmount <= 0) {
        alert("Please enter a valid bet amount.");
        return;
    }

    const betContract = new ethers.Contract("your_contract_address_here", [
        // ABI dari kontrak TotoChain
    ], signer);

    try {
        const tx = await betContract.placeBet(1, betAmount, 1, false, { value: ethers.utils.parseEther(betAmount.toString()) });
        await tx.wait();
        alert("Bet placed successfully!");
        await loadBetHistory();  // Refresh bet history
    } catch (error) {
        alert("Error placing bet: " + error.message);
    }
}

// Fungsi untuk mengambil riwayat taruhan pribadi
async function loadBetHistory() {
    if (!walletAddress) return;

    const betContract = new ethers.Contract("your_contract_address_here", [
        "function getUserBetHistory(address) view returns (tuple[])"
    ], provider);

    const bets = await betContract.getUserBetHistory(walletAddress);
    personalBetHistory.innerHTML = `<h3>Personal Bet History:</h3>`;
    bets.forEach(bet => {
        personalBetHistory.innerHTML += `<div>Bet ID: ${bet.id}, Amount: ${ethers.utils.formatEther(bet.amount)} ETH</div>`;
    });

    // Load Public Bet History
    loadPublicBetHistory();
}

// Fungsi untuk mengambil riwayat taruhan umum
async function loadPublicBetHistory() {
    const betContract = new ethers.Contract("your_contract_address_here", [
        "function getPublicBetHistory() view returns (tuple[])"
    ], provider);

    const bets = await betContract.getPublicBetHistory();
    publicBetHistory.innerHTML = `<h3>Public Bet History:</h3>`;
    bets.forEach(bet => {
        publicBetHistory.innerHTML += `<div>Bet ID: ${bet.id}, Amount: ${ethers.utils.formatEther(bet.amount)} ETH</div>`;
    });
}

// Fungsi untuk menambahkan komentar
async function submitComment() {
    const commentText = document.getElementById('comment-input').value;
    if (!commentText) {
        alert("Please enter a comment.");
        return;
    }

    // Tambahkan interaksi dengan smart contract untuk menambahkan komentar
    alert("Comment submitted!");
}

// Event listeners
connectWalletBtn.addEventListener('click', connectWallet);
disconnectWalletBtn.addEventListener('click', disconnectWallet);
document.getElementById('place-bet-btn').addEventListener('click', placeBet);
document.getElementById('submit-comment-btn').addEventListener('click', submitComment);
    </script>
</body>
</html>
