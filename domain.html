<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LotDomain DApp</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.3/dist/web3.min.js"></script>
    <style>
      body {
    font-family: Arial, sans-serif;
    text-align: center;
    background-color: #f4f4f4;
}

header {
    background: #333;
    color: white;
    padding: 10px;
}

button {
    padding: 10px;
    margin-top: 10px;
    background: #007bff;
    color: white;
    border: none;
    cursor: pointer;
}

input {
    padding: 8px;
    margin: 5px;
    width: 200px;
}

/* Bottom Navigation */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: #222;
    display: flex;
    justify-content: space-around;
    padding: 5px 0;
    box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2);
}

.bottom-nav button {
    background: none;
    border: none;
    color: white;
    font-size: 10px;
    text-align: center;
    cursor: pointer;
    padding: 5px;
    flex: 1;
}

.bottom-nav button span {
    font-size: 15px; /* Icon lebih besar */
    display: block;
}

.bottom-nav button.active {
    color: #007bff; /* Warna biru untuk tombol aktif */
    font-weight: bold;
}
    </style>
</head>
<body>
    <header>
        <h1>LotDomain DApp</h1>
        <button onclick="connectWallet()">Hubungkan Wallet</button>
        <p id="walletAddress">Belum terhubung</p>

    </header>

    <main>
        <section id="register">
            <h2>Daftarkan Domain</h2>
            <input type="text" id="domainName" placeholder="Masukkan nama domain">
            <button onclick="registerDomain()">Daftar</button>
        </section>

        <section id="transfer">
            <h2>Transfer Domain</h2>
            <input type="text" id="transferDomain" placeholder="Nama domain">
            <input type="text" id="transferTo" placeholder="Alamat penerima">
            <button onclick="transferDomain()">Transfer</button>
        </section>

        <section id="auction">
            <h2>Pelelangan Domain</h2>
            <input type="text" id="auctionDomain" placeholder="Nama domain">
            <input type="number" id="minBid" placeholder="Minimal Bid (ETH)">
            <button onclick="startAuction()">Mulai Lelang</button>
        </section>

        <section id="rent">
            <h2>Sewa Domain</h2>
            <input type="text" id="rentDomain" placeholder="Nama domain">
            <input type="number" id="rentAmount" placeholder="Jumlah sewa (ETH)">
            <button onclick="rentDomain()">Sewa</button>
        </section>

        <section id="resolve">
            <h2>Gunakan Domain</h2>
            <input type="text" id="resolveDomain" placeholder="Nama domain (contoh: nama.lot)">
            <button onclick="resolveDomain()">Cari Alamat</button>
        </section>

        <section id="setAddress">
            <h2>Tautkan Domain ke Alamat</h2>
            <input type="text" id="setDomain" placeholder="Nama domain">
            <input type="text" id="setAddress" placeholder="Alamat wallet">
            <button onclick="setDomainAddress()">Simpan</button>
        </section>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <button class="nav-btn active" onclick="showSection('register', this)">
                <span>üöÄ</span><br>Transfer
            </button>
            <button class="nav-btn" onclick="showSection('transfer', this)">
                <span>üõí</span><br>Auction
            </button>
            <button class="nav-btn" onclick="showSection('auction', this)">
                <span>‚öôÔ∏è</span><br>Setting
            </button>
        </div>
        
    </main>

    <script src="app.js"></script>
    <script>
      let web3;
let contract;
const contractAddress = "0x1234567890abcdef"; // Ganti dengan alamat kontrak

async function connectWallet() {
    if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        await window.ethereum.request({ method: "eth_requestAccounts" });
        contract = new web3.eth.Contract(abi, contractAddress);
        alert("Wallet terhubung!");
    } else {
        alert("Metamask tidak ditemukan!");
    }
}

async function registerDomain() {
    const name = document.getElementById("domainName").value;
    const accounts = await web3.eth.getAccounts();
    const fee = await contract.methods.getRegistrationFee(name).call();
    
    await contract.methods.registerDomain(name, ".lot", 0).send({
        from: accounts[0],
        value: fee
    });

    alert(`Domain ${name} berhasil didaftarkan!`);
}

async function registerDomain() {
    const name = document.getElementById("domainName").value;
    if (!name) {
        alert("Masukkan nama domain terlebih dahulu!");
        return;
    }

    const accounts = await web3.eth.getAccounts();

    // Cek apakah domain sudah terdaftar
    const isRegistered = await contract.methods.isDomainRegistered(name).call();
    if (isRegistered) {
        alert(`Domain ${name} sudah terdaftar! Coba nama lain.`);
        return;
    }

    // Lanjutkan jika domain tersedia
    const fee = await contract.methods.getRegistrationFee(name).call();
    
    await contract.methods.registerDomain(name, ".lot", 0).send({
        from: accounts[0],
        value: fee
    });

    alert(`Domain ${name} berhasil didaftarkan!`);
}

async function transferDomain() {
    const name = document.getElementById("transferDomain").value;
    const to = document.getElementById("transferTo").value;
    const accounts = await web3.eth.getAccounts();

    await contract.methods.transferDomain(name, to).send({ from: accounts[0] });
    alert(`Domain ${name} berhasil ditransfer ke ${to}`);
}

async function startAuction() {
    const name = document.getElementById("auctionDomain").value;
    const minBid = document.getElementById("minBid").value;
    const accounts = await web3.eth.getAccounts();

    await contract.methods.startAuction(name, web3.utils.toWei(minBid, "ether")).send({ from: accounts[0] });
    alert(`Pelelangan domain ${name} dimulai!`);
}

async function rentDomain() {
    const name = document.getElementById("rentDomain").value;
    const amount = document.getElementById("rentAmount").value;
    const accounts = await web3.eth.getAccounts();

    await contract.methods.rentDomain(name).send({
        from: accounts[0],
        value: web3.utils.toWei(amount, "ether")
    });

    alert(`Domain ${name} berhasil disewa!`);
}

document.getElementById("connectWallet").addEventListener("click", connectWallet);

const abi = [/* Masukkan ABI kontrak di sini */];

// Used Domain
async function resolveDomain() {
    const domain = document.getElementById("resolveDomain").value;
    try {
        const address = await contract.methods.resolve(domain).call();
        alert(`Alamat yang terkait dengan ${domain}: ${address}`);
    } catch (error) {
        alert("Domain tidak ditemukan atau belum dikaitkan dengan alamat!");
    }
}

async function setDomainAddress() {
    const domain = document.getElementById("setDomain").value;
    const newAddress = document.getElementById("setAddress").value;
    const accounts = await web3.eth.getAccounts();

    await contract.methods.setAddress(domain, newAddress).send({ from: accounts[0] });
    alert(`Alamat ${newAddress} telah ditautkan ke ${domain}`);
}

// Menu
function showSection(sectionId, btn) {
    // Sembunyikan semua halaman
    document.querySelectorAll(".page").forEach(section => {
        section.style.display = "none";
    });
    document.getElementById(sectionId).style.display = "block";

    // Hapus status 'active' dari semua tombol
    document.querySelectorAll(".nav-btn").forEach(button => {
        button.classList.remove("active");
    });

    // Tambahkan status 'active' pada tombol yang diklik
    btn.classList.add("active");
}
    </script>
</body>
</html>
