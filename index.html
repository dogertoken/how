<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World History on Blockchain</title>
    <link rel="stylesheet" href="stylecss">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        background-color: #f4f4f4;
        margin: 0;
        padding: 20px;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 10px;
        max-width: 900px;
        margin: auto;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px;
        cursor: pointer;
        margin-top: 10px;
      }
      button:hover {
        background: #0056b3;
      }
      input, textarea {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border: 1px solid #ddd;
      }
      .pagination {
        margin-top: 20px;
      }
      .pagination button {
        margin: 0 5px;
      }
    .footer {
    text-align: center;
    padding: 20px;
    background: #fff;
    box-shadow: inset 8px 8px 16px #bebebe, inset -8px -8px 16px #ffffff;
    border-radius: 12px;
}

.social-links {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 10px;
}

.social-icon {
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #e0e0e0;
    border-radius: 50%;
    box-shadow: 6px 6px 12px #bebebe, -6px -6px 12px #ffffff;
    font-size: 24px;
    color: #555;
    text-decoration: none;
    transition: all 0.3s ease;
}

.social-icon:hover {
    box-shadow: inset 4px 4px 8px #bebebe, inset -4px -4px 8px #ffffff;
    color: #333;
}
  /* Menu Toggle (Mobile) */
.menu-toggle {
    display: none;
    font-size: 24px;
    cursor: pointer;
    padding: 10px;
    background: #e0e0e0;
    border-radius: 8px;
    box-shadow: 4px 4px 8px #bebebe, -4px -4px 8px #ffffff;
}

/* Navbar */
.navbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 30px;
    background: #fff;
    box-shadow: 8px 8px 16px #bebebe, -8px -8px 16px #ffffff;
    border-radius: 12px;
}

.navbar .logo {
    font-size: 24px;
    font-weight: bold;
    color: #333;
    text-shadow: 2px 2px 4px #bebebe;
}

/* Menu Links */
.nav-links {
    list-style: none;
    display: flex;
    gap: 20px;
    margin: 0;
    padding: 0;
}

.nav-links li {
    display: inline-block;
}

.nav-links a {
    text-decoration: none;
    font-size: 18px;
    color: #555;
    padding: 10px 15px;
    border-radius: 10px;
    background: #e0e0e0;
    box-shadow: 6px 6px 12px #bebebe, -6px -6px 12px #ffffff;
    transition: all 0.3s ease;
}

/* Hover Effect */
.nav-links a:hover {
    box-shadow: inset 4px 4px 8px #bebebe, inset -4px -4px 8px #ffffff;
    color: #333;
        }
    /* Menu Toggle (Mobile) */
.menu-toggle {
    display: none;
    font-size: 20px; /* Ukuran lebih kecil */
    cursor: pointer;
    padding: 6px 10px; /* Padding lebih kecil */
    background: #e0e0e0;
    border-radius: 6px; /* Sedikit lebih kecil */
    box-shadow: 3px 3px 6px #bebebe, -3px -3px 6px #ffffff;
}

/* Responsive Navbar */
@media screen and (max-width: 768px) {
    .nav-links {
        display: none;
        flex-direction: column;
        position: absolute;
        top: 50px; /* Sedikit lebih tinggi */
        left: 50%;
        transform: translateX(-50%);
        background: #e0e0e0;
        border-radius: 10px;
        box-shadow: 6px 6px 12px #bebebe, -6px -6px 12px #ffffff;
        width: 85%;
        text-align: center;
        padding: 8px 0;
    }

    .nav-links.active {
        display: flex;
    }

    .menu-toggle {
        display: block;
        position: absolute;
        right: 15px;
        top: 15px;
    }
    }
    </style>
</head>
<body>

    <nav class="navbar">
    <div class="logo">MyWebsite</div>
    <ul class="nav-links">
        <li><a href="#">Home</a></li>
        <li><a href="#">About</a></li>
        <li><a href="#">Services</a></li>
        <li><a href="#">Contact</a></li>
    </ul>
    <div class="menu-toggle" onclick="toggleMenu()">‚ò∞</div>
    </nav>
    
    <div class="container">
        <h1>‚è≥Ô∏è World History on Blockchain</h1>
        <button id="connectWallet">üîó Konek Wallet</button>
        <p id="walletAddress">Wallet: -</p>
        <p id="networkStatus">Jaringan: -</p>
        <p id="balance">Saldo: 0 HIST</p>

        <hr>

        <h2>Tambahkan Sejarah</h2>
        <input type="text" id="title" placeholder="Judul Sejarah">
        <textarea id="description" placeholder="Deskripsi Sejarah"></textarea>
        <button onclick="addHistory()">üìù Tambah Sejarah</button>

        <hr>

        <h2>Riwayat Sejarah</h2>
        <ul id="historyList"></ul>
        <button onclick="fetchHistory()">Muat Lebih Banyak</button>

        <!-- Pagination Controls -->
        <div class="pagination">
            <button id="firstPage" onclick="goToFirstPage()">First</button>
            <button id="previousPage" onclick="goToPreviousPage()">‚¨ÖÔ∏è Left</button>
            <span id="pageNumbers"></span>
            <button id="nextPage" onclick="goToNextPage()">‚û°Ô∏è Right</button>
        </div>
    </div>

    <footer class="footer">
    <div class="social-links">
        <a href="https://facebook.com" class="social-icon"><i class="fab fa-facebook-f"></i></a>
        <a href="https://twitter.com" class="social-icon"><i class="fab fa-x-twitter"></i></a>
        <a href="https://instagram.com" class="social-icon"><i class="fab fa-instagram"></i></a>
        <a href="https://youtube.com" class="social-icon"><i class="fab fa-youtube"></i></a>
    </div>
    <p>&copy; 2025 Your Website. All Rights Reserved.</p>
    </footer>

    <script src="scriptjs"></script>
    <script>
      const CONTRACT_ADDRESS = "0xYOUR_CONTRACT_ADDRESS"; // Ganti dengan alamat kontrak yang dideploy
      const ABI = [
        // Masukkan ABI kontrak di sini
      ];

      const BASE_MAINNET_PARAMS = {
          chainId: "0x2105", // Base Mainnet (8453 dalam hexa)
          chainName: "Base Mainnet",
          nativeCurrency: { name: "ETH", symbol: "ETH", decimals: 18 },
          rpcUrls: ["https://mainnet.base.org"],
          blockExplorerUrls: ["https://basescan.org"],
      };

      let provider, signer, contract;
      let currentPage = 1;
      const itemsPerPage = 10;

      // **Memaksa pengguna ke jaringan Base Mainnet**
      async function switchToBase() {
          try {
              await window.ethereum.request({
                  method: "wallet_switchEthereumChain",
                  params: [{ chainId: BASE_MAINNET_PARAMS.chainId }],
              });
          } catch (error) {
              if (error.code === 4902) {
                  await window.ethereum.request({
                      method: "wallet_addEthereumChain",
                      params: [BASE_MAINNET_PARAMS],
                  });
              } else {
                  console.error("Gagal beralih ke jaringan Base:", error);
              }
          }
      }

      // **Koneksi Wallet dengan Signature**
      async function connectWallet() {
          if (!window.ethereum) {
              alert("Silakan instal MetaMask!");
              return;
          }

          provider = new ethers.providers.Web3Provider(window.ethereum);
          signer = provider.getSigner();
          contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

          try {
              await switchToBase(); // Paksa ke jaringan Base

              const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
              const address = accounts[0];

              // **Meminta pengguna menandatangani pesan**
              const message = `Konfirmasi koneksi ke History on Blockchain pada ${new Date().toLocaleString()}`;
              await signer.signMessage(message);

              document.getElementById("walletAddress").innerText = `Wallet: ${address}`;
              document.getElementById("networkStatus").innerText = "Jaringan: Base Mainnet";

              getBalance(); // Perbarui saldo setelah koneksi
              fetchHistory(); // Muat riwayat sejarah

          } catch (error) {
              console.error("Koneksi gagal:", error);
          }
      }

      // **Menampilkan saldo token pengguna**
      async function getBalance() {
          try {
              const address = await signer.getAddress();
              const balance = await contract.balanceOf(address);
              document.getElementById("balance").innerText = `Saldo: ${ethers.utils.formatUnits(balance, 18)} HIST`;
          } catch (error) {
              console.error("Gagal mendapatkan saldo:", error);
          }
      }

      // **Menambahkan catatan sejarah**
      async function addHistory() {
          const title = document.getElementById("title").value;
          const description = document.getElementById("description").value;

          if (!title || !description) {
              alert("Judul dan Deskripsi harus diisi!");
              return;
          }

          try {
              const tx = await contract.addHistory(title, description);
              await tx.wait();
              alert("Sejarah berhasil ditambahkan!");

              getBalance(); // Perbarui saldo
              fetchHistory(); // Muat ulang daftar sejarah

          } catch (error) {
              console.error("Gagal menambahkan sejarah:", error);
          }
      }

      // **Mendapatkan riwayat sejarah dari kontrak dengan paging**
      async function fetchHistory() {
          try {
              const histories = await contract.getAllHistories();
              const historyList = document.getElementById("historyList");
              historyList.innerHTML = "";

              const startIndex = (currentPage - 1) * itemsPerPage;
              const endIndex = Math.min(startIndex + itemsPerPage, histories.length);
              const visibleHistories = histories.slice(startIndex, endIndex);

              visibleHistories.forEach(history => {
                  const li = document.createElement("li");
                  li.innerHTML = `<strong>${history.title}</strong> - ${history.description} <br> ‚è≥ ${new Date(history.timestamp * 1000).toLocaleString()}`;
                  historyList.appendChild(li);
              });

              updatePagination();

          } catch (error) {
              console.error("Gagal memuat sejarah:", error);
          }
      }

      // **Update tombol pagination**
      function updatePagination() {
          const pageNumbers = document.getElementById("pageNumbers");
          pageNumbers.innerHTML = `Page ${currentPage}`;

          // Disable previous/next buttons if on first/last page
          document.getElementById("previousPage").disabled = currentPage === 1;
          document.getElementById("nextPage").disabled = currentPage * itemsPerPage >= histories.length;
      }

      // **Fungsi navigasi halaman**
      function goToFirstPage() {
          currentPage = 1;
          fetchHistory();
      }

      function goToPreviousPage() {
          if (currentPage > 1) {
              currentPage--;
              fetchHistory();
          }
      }

      function goToNextPage() {
          currentPage++;
          fetchHistory();
      }

     function toggleMenu() {
        const navLinks = document.querySelector(".nav-links");
        navLinks.classList.toggle("active");
     }

      // **Event Listener untuk Koneksi Wallet**
      document.getElementById("connectWallet").addEventListener("click", connectWallet);
    </script>
</body>
</html>
