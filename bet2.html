<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Betting DApp</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.0/dist/ethers.min.js"></script>
    <style>
        /* Styles for wallet and bet modal */
        #betModal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            width: 400px;
            border-radius: 10px;
        }
        .modal-content input {
            width: 100%;
            margin-bottom: 10px;
        }
        .btn {
            cursor: pointer;
            padding: 10px 20px;
            margin: 5px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
        }
    </style>
</head>
<body>

<!-- Wallet Connection and Info -->
<div id="walletInfo">
    <button class="btn" id="connectWalletBtn">Connect Wallet</button>
    <button class="btn" id="disconnectWalletBtn" style="display:none;">Disconnect Wallet</button>
    <p>Wallet Address: <span id="walletAddress">-</span></p>
    <p>ETH Balance: <span id="ethBalance">-</span></p>
    <p>USDT Balance: <span id="usdtBalance">-</span></p>
</div>

<!-- Bet Button -->
<button class="btn" id="placeBetBtn">Place Bet</button>

<!-- Bet Modal -->
<div id="betModal">
    <div class="modal-content">
        <span class="close" style="float:right; cursor:pointer;">&times;</span>
        <h3>Place Bet</h3>
        <label for="betNumber">Enter Bet (2D, 3D, 4D):</label>
        <input type="text" id="betNumber" placeholder="e.g., 12, 123, 1234" maxlength="4" />
        
        <label for="betCount">Bet Count (1 - 99):</label>
        <input type="number" id="betCount" placeholder="1 - 99" min="1" max="99" />

        <label for="paymentMethod">Payment Method:</label>
        <select id="paymentMethod">
            <option value="eth">ETH</option>
            <option value="usdt">USDT</option>
        </select>

        <button class="btn" id="calculatePriceBtn">Calculate Price</button>

        <div id="priceDetails" style="display:none;">
            <p>Total Price: <span id="totalPrice"></span> <span id="currencyType"></span></p>
            <button class="btn" id="confirmBetBtn" style="display:none;">Confirm Bet</button>
        </div>
    </div>
</div>

<script>
    const contractAddress = "YOUR_CONTRACT_ADDRESS";
    const usdtAddress = "USDT_CONTRACT_ADDRESS"; // USDT contract address for ERC20
    const betPriceETH = 0.0001; // 0.0001 ETH per bet
    const betPriceUSDT = 0.5; // 0.5 USDT per bet
    
    let provider, signer, contract;
    let currentAccount = null;

    // ABI from your smart contract (add the real ABI here)
    const abi = [
        "function placeBet(uint256 number, uint256 betCount, uint256 betType, bool isUSDT) public payable",
        "function getBet(uint256 betId) public view returns (address, uint256, uint256, uint256, uint256, uint256, bool, uint256)",
        "function getBetCount() public view returns (uint256)"
    ];

    async function connectWallet() {
        if (window.ethereum) {
            provider = new ethers.BrowserProvider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            signer = provider.getSigner();
            currentAccount = await signer.getAddress();
            contract = new ethers.Contract(contractAddress, abi, signer);
            document.getElementById("walletAddress").textContent = currentAccount;
            updateBalances();
            document.getElementById("connectWalletBtn").style.display = "none";
            document.getElementById("disconnectWalletBtn").style.display = "block";
        } else {
            alert("Metamask not detected!");
        }
    }

    async function disconnectWallet() {
        currentAccount = null;
        document.getElementById("walletAddress").textContent = "-";
        document.getElementById("ethBalance").textContent = "-";
        document.getElementById("usdtBalance").textContent = "-";
        document.getElementById("connectWalletBtn").style.display = "block";
        document.getElementById("disconnectWalletBtn").style.display = "none";
    }

    async function updateBalances() {
        const ethBalance = await provider.getBalance(currentAccount);
        const usdtContract = new ethers.Contract(usdtAddress, [
            "function balanceOf(address owner) view returns (uint256)"
        ], provider);
        const usdtBalance = await usdtContract.balanceOf(currentAccount);
        
        document.getElementById("ethBalance").textContent = ethers.utils.formatEther(ethBalance);
        document.getElementById("usdtBalance").textContent = ethers.utils.formatUnits(usdtBalance, 6);
    }

    // Show Bet Modal
    document.getElementById("placeBetBtn").addEventListener("click", () => {
        const betModal = document.getElementById("betModal");
        betModal.style.display = "block";
    });

    // Close Modal
    document.querySelector(".close").addEventListener("click", () => {
        const betModal = document.getElementById("betModal");
        betModal.style.display = "none";
    });

    // Calculate Bet Price
    document.getElementById("calculatePriceBtn").addEventListener("click", () => {
        const betNumber = document.getElementById("betNumber").value;
        const betCount = document.getElementById("betCount").value;
        
        if (!betNumber || !betCount || betCount < 1 || betCount > 99 || !/^\d{2,4}$/.test(betNumber)) {
            alert("Enter a valid bet number (2D, 3D, 4D) and bet count (1-99).");
            return;
        }

        let totalPrice;
        const isUSDT = document.getElementById("paymentMethod").value === "usdt";
        
        if (isUSDT) {
            totalPrice = betPriceUSDT * betCount;
            document.getElementById("currencyType").textContent = "USDT";
        } else {
            totalPrice = betPriceETH * betCount;
            document.getElementById("currencyType").textContent = "ETH";
        }

        document.getElementById("totalPrice").textContent = totalPrice;
        document.getElementById("priceDetails").style.display = "block";
        document.getElementById("confirmBetBtn").style.display = "block";
    });

    // Confirm Bet and Place Transaction
    document.getElementById("confirmBetBtn").addEventListener("click", async () => {
        const betNumber = document.getElementById("betNumber").value;
        const betCount = document.getElementById("betCount").value;
        const isUSDT = document.getElementById("paymentMethod").value === "usdt";
        const totalPrice = document.getElementById("totalPrice").textContent;
        
        let transaction;
        try {
            if (isUSDT) {
                transaction = await contract.placeBet(betNumber, betCount, 0, true, { value: 0 });
            } else {
                transaction = await contract.placeBet(betNumber, betCount, 0, false, { value: ethers.utils.parseEther(totalPrice) });
            }

            await transaction.wait();
            alert("Bet placed successfully!");
            document.getElementById("betModal").style.display = "none";
            updateBalances();
        } catch (error) {
            console.error("Error placing bet: ", error);
            alert("Bet placement failed!");
        }
    });

    // Event listeners for wallet connection
    document.getElementById("connectWalletBtn").addEventListener("click", connectWallet);
    document.getElementById("disconnectWalletBtn").addEventListener("click", disconnectWallet);

</script>

</body>
</html>
