<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bet History</title>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.8.0/web3.min.js"></script>
    <style>
    body {
    display: flex;
    justify-content: center;  /* Pusatkan secara horizontal */
    align-items: center;  /* Pusatkan secara vertikal */
    height: 100vh;  /* Buat agar mengambil seluruh tinggi layar */
    margin: 0;
    font-family: Ubuntu, sans-serif;
    text-align: center;
    background-color: #000000; /* Latar belakang hitam pekat */
    color: #f8f1e4; /* Font putih tulang */
}

.container {
    width: 100%;
    max-width: 1200px;
    margin: auto;
    padding: 20px;
    background: #000000; /* Efek transparan */
    box-shadow: 0px 0px 10px rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    backdrop-filter: blur(10px);
}

/* Kolom Input dengan Efek Glassmorphism */
input {
    display: block;
    margin: 10px auto;
    padding: 10px;
    width: 90%;
    font-size: 14px;
    font-weight: 600;
    text-align: center;
    background: rgba(255, 255, 255, 0.1);
    color: white;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 200, 255, 0.3);
}

input::placeholder {
    color: rgba(255, 255, 255, 0.5);
}

/* Tombol Futuristik (Lebih Pendek) */
button {
    display: block;
    margin: 8px auto;
    padding: 6px; /* Dipendekin */
    width: 40%; /* Lebih pendek */
    border-radius: 6px;
    font-size: 10px;
    font-weight: bold;
    cursor: pointer;
    text-transform: none;
    transition: all 0.3s ease-in-out;
    background: linear-gradient(135deg, #007bff, #0048ff); /* Biru gradient */
    color: white;
    border: none;
    box-shadow: 0 3px 8px rgba(0, 120, 255, 0.3);
}

button:hover {
    background: linear-gradient(135deg, #0048ff, #007bff);
    transform: scale(1.05);
    box-shadow: 0 3px 12px rgba(0, 120, 255, 0.5);
}

/* Tombol Disconnect (Lebih Pendek) */
#disconnectWallet {
    background: linear-gradient(135deg, #ff0033, #cc0000);
    box-shadow: 0 3px 8px rgba(255, 0, 51, 0.3);
}

#disconnectWallet:hover {
    background: linear-gradient(135deg, #cc0000, #ff0033);
    box-shadow: 0 3px 12px rgba(255, 0, 51, 0.5);
}

/* Container Tombol */
.button-container {
    display: flex;
    justify-content: center;
    gap: 8px;
}

/* Ukuran Wallet Address Lebih Kecil */
#walletAddress {
    font-size: 12px;
}

#betHistory, #userBets {
    font-size: 13px; /* Ukuran font yang nyaman */
    text-align: justify; /* Rata kiri-kanan seperti di buku */
    hyphens: auto; /* Tambahkan pemenggalan kata jika perlu */
    line-height: 1.8; /* Jarak antar baris agar lebih nyaman dibaca */
    max-width: 600px; /* Batasi lebar agar tidak terlalu panjang */
    margin: auto; /* Pusatkan jika diperlukan */
    padding: 15px; /* Beri ruang di dalam agar tidak terlalu mepet */
    text-indent: 20px; /* Tambahkan indentasi di awal paragraf */
}

table {
    width: 100%; /* Bisa diperkecil lagi, misalnya 50% jika terlalu lebar */
    max-width: 900px; /* Agar tabel tidak terlalu besar di layar lebar */
    border-collapse: collapse;
    margin: 20px auto; /* 'auto' agar tabel tetap di tengah */
    font-size: 18px; /* Kecilkan agar tabel lebih compact */
    text-align: left;
}

th, td {
    padding: 8px; /* Kurangi padding agar tabel lebih kecil */
    border: 1px solid #ddd;
}

th {
    background: linear-gradient(135deg, #00b7ff, #007bff);
    color: white; /* Agar teks lebih kontras */
}

.footer-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: rgba(0, 0, 0, 0.9); /* Warna hitam transparan */
    color: white;
    display: flex;
    justify-content: space-around;
    padding: 10px 0;
    z-index: 999;
}

/* Supaya tombolnya proporsional */
.footer-nav button {
    background: none;
    border: none;
    color: white;
    font-size: 14px;
    padding: 10px;
    cursor: pointer;
}

/* Gaya untuk modal */
.modal {
  display: none; /* Awalnya modal disembunyikan */
  position: fixed;
  z-index: 999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5); /* Transparan gelap */
}

/* Konten modal */
.modal-content {
  background: #000000;
  color: white;
  margin: 10% auto;
  padding: 20px;
  width: 90%;
  max-width: 900px;
  border-radius: 10px;
  text-align: center;
  box-shadow: 0px 0px 15px rgba(255, 255, 255, 0.2);
}

/* Tombol close */
.close {
  color: white;
  float: right;
  font-size: 24px;
  cursor: pointer;
}
.close:hover {
  color: red;
}
    </style>
</head>
<body>
    <div class="container">
        <button id="connectWallet" onclick="connectWallet()">Connect Wallet</button>
        <button id="disconnectWallet" onclick="disconnectWallet()" style="display:none;">Disconnect Wallet</button>
        
        <h2>Place a Bet</h2>
        
        <h2>Search Bet Winners</h2>
        <div id="betHistory"></div>

    </div>

    <script>
        const contractAddress = "0x410F02E143Ba921FEdda48830d545154F5E809ab";
        const contractABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"user","type":"address"}],"name":"BetLiked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"player","type":"address"},{"indexed":false,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":false,"internalType":"string","name":"number","type":"string"},{"indexed":false,"internalType":"uint256","name":"betAmount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"blockNumber","type":"uint256"},{"indexed":false,"internalType":"bytes32","name":"txHash","type":"bytes32"}],"name":"BetPlaced","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"drawId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"winningNumber","type":"uint256"}],"name":"BetResultSet","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"string","name":"comment","type":"string"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"CommentAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"commentIndex","type":"uint256"}],"name":"CommentDeleted","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"commentIndex","type":"uint256"},{"indexed":false,"internalType":"string","name":"newComment","type":"string"}],"name":"CommentUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"winner","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"ETHClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"winner","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"WinnerSet","type":"event"},{"inputs":[{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"string","name":"_comment","type":"string"}],"name":"addComment","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"betComments","outputs":[{"internalType":"address","name":"commenter","type":"address"},{"internalType":"string","name":"text","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"bool","name":"isDeleted","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"betHistory","outputs":[{"internalType":"address","name":"player","type":"address"},{"internalType":"string","name":"number","type":"string"},{"internalType":"uint256","name":"betAmount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint256","name":"blockNumber","type":"uint256"},{"internalType":"bytes32","name":"txHash","type":"bytes32"},{"internalType":"bool","name":"isETH","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"},{"internalType":"address","name":"","type":"address"}],"name":"betLikes","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"betPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"betResults","outputs":[{"internalType":"uint256","name":"drawId","type":"uint256"},{"internalType":"uint256","name":"winningNumber","type":"uint256"},{"internalType":"bool","name":"isProcessed","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"claimETH","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"contractBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"uint256","name":"commentIndex","type":"uint256"}],"name":"deleteComment","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"uint256","name":"commentIndex","type":"uint256"},{"internalType":"string","name":"newComment","type":"string"}],"name":"editComment","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getAllBets","outputs":[{"components":[{"internalType":"address","name":"player","type":"address"},{"internalType":"string","name":"number","type":"string"},{"internalType":"uint256","name":"betAmount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint256","name":"blockNumber","type":"uint256"},{"internalType":"bytes32","name":"txHash","type":"bytes32"},{"internalType":"bool","name":"isETH","type":"bool"}],"internalType":"struct BetHistory.Bet[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"betId","type":"bytes32"}],"name":"getComments","outputs":[{"components":[{"internalType":"address","name":"commenter","type":"address"},{"internalType":"string","name":"text","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"bool","name":"isDeleted","type":"bool"}],"internalType":"struct BetHistory.Comment[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getUserBets","outputs":[{"components":[{"internalType":"address","name":"player","type":"address"},{"internalType":"string","name":"number","type":"string"},{"internalType":"uint256","name":"betAmount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint256","name":"blockNumber","type":"uint256"},{"internalType":"bytes32","name":"txHash","type":"bytes32"},{"internalType":"bool","name":"isETH","type":"bool"}],"internalType":"struct BetHistory.Bet[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"betId","type":"bytes32"}],"name":"likeBet","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"maxBet","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"minBet","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_number","type":"string"},{"internalType":"uint256","name":"_times","type":"uint256"},{"internalType":"bool","name":"_isETH","type":"bool"}],"name":"placeBet","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_drawId","type":"uint256"},{"internalType":"uint256","name":"_winningNumber","type":"uint256"}],"name":"setBetResult","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_winner","type":"address"},{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"setWinner","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"userBets","outputs":[{"internalType":"address","name":"player","type":"address"},{"internalType":"string","name":"number","type":"string"},{"internalType":"uint256","name":"betAmount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint256","name":"blockNumber","type":"uint256"},{"internalType":"bytes32","name":"txHash","type":"bytes32"},{"internalType":"bool","name":"isETH","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"winnings","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"withdrawETH","outputs":[],"stateMutability":"nonpayable","type":"function"},{"stateMutability":"payable","type":"receive"}];
        const betPrice = 0.000175;
        
        let web3;
        let contract;
        let userAccount;

        async function connectWallet() {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
                userAccount = accounts[0];
                contract = new web3.eth.Contract(contractABI, contractAddress);
                document.getElementById("connectWallet").style.display = "none";
                document.getElementById("disconnectWallet").style.display = "inline-block";
                loadBetHistory();
                loadUserBets();
            } else {
                alert("Please install MetaMask to use this feature.");
            }
        }

        function disconnectWallet() {
            userAccount = null;
            document.getElementById("connectWallet").style.display = "inline-block";
            document.getElementById("disconnectWallet").style.display = "none";
            alert("Wallet disconnected");
        }

    async function placeBet() {
    if (!userAccount) {
        alert("Please connect your wallet first.");
        return;
    }

    if (!validateForm()) return; // Pastikan input valid sebelum lanjut

    const number = document.getElementById("betNumber").value;
    const times = parseInt(document.getElementById("betTimes").value, 10);
    
    if (isNaN(times) || times < 1) {
        alert("Invalid bet times value.");
        return;
    }

    const value = web3.utils.toWei((0.000175 * times).toString(), "ether");

    try {
        alert("Sending your bet..."); // Konfirmasi awal
        await contract.methods.placeBet(number.toString(), times, true).send({ from: userAccount, value: value });
        alert("Bet placed successfully!"); // Konfirmasi setelah berhasil

        loadBetHistory();
        loadUserBets();
    } catch (error) {
        alert("Bet failed: " + (error.message || "Unknown error")); // Tangani error dengan lebih baik
    }
}

function limitBetNumber(input) {
    let value = input.value.replace(/\D/g, ''); // Hanya angka, hapus karakter non-angka

    // Pastikan tetap ada leading zero jika diketik manual
    if (value.length > 4) {
        value = value.slice(0, 4); // Batasi maksimal 4 digit
    }

    // Validasi panjang angka minimal 2 digit
    if (value.length > 0 && value.length < 2) {
        document.getElementById("betNumberWarning").innerText = "Minimum 2 digits (00 - 9999)";
    } else {
        document.getElementById("betNumberWarning").innerText = "";
    }

    input.value = value; // Set kembali ke input tanpa menghapus nol di depan
}

function limitDigits(input, min, max) {
    let value = input.value.replace(/\D/g, '').trim();
    let numValue = parseInt(value, 10) || 0;

    if (!value) {
        document.getElementById("betTimesWarning").innerText = "Cannot be empty";
        input.value = ""; // Kosongkan input jika tidak valid
    } else if (numValue < min) {
        input.value = min; // Paksa minimal
        document.getElementById("betTimesWarning").innerText = `Enter numbers ${min} - ${max}`;
    } else if (numValue > max) {
        input.value = max; // Paksa maksimal
        document.getElementById("betTimesWarning").innerText = `Enter numbers ${min} - ${max}`;
    } else {
        document.getElementById("betTimesWarning").innerText = "";
        input.value = numValue;
    }
}

function validateForm() {
    let betNumber = document.getElementById("betNumber").value;
    let betTimes = parseInt(document.getElementById("betTimes").value, 10) || 0;
    let isValid = true;

    if (betNumber.length < 2 || betNumber.length > 4) {
        document.getElementById("betNumberWarning").innerText = "Minimum 2 digits, maximum 4 digits (00 - 9999)";
        isValid = false;
    } else {
        document.getElementById("betNumberWarning").innerText = "";
    }

    if (betTimes < 1 || betTimes > 99) {
        document.getElementById("betTimesWarning").innerText = "Enter number 1 - 99";
        isValid = false;
    } else {
        document.getElementById("betTimesWarning").innerText = "";
    }

    return isValid;
    }

    function validateBetTimes() {
    let betTimesInput = document.getElementById("betTimes");
    let betTimesStr = betTimesInput.value.trim(); // Ambil nilai tanpa spasi
    let warning = document.getElementById("betTimesWarning");

    // Jika input kosong, reset ETH ke 0 dan keluar dari fungsi
    if (betTimesStr === "") {
        warning.textContent = "";
        document.getElementById("totalETH").textContent = "0.000000";
        return;
    }

    // Konversi ke angka
    let betTimes = Number(betTimesStr);

    if (isNaN(betTimes) || betTimes < 1) {
        warning.textContent = "Minimal 1x bet!";
        betTimesInput.value = ""; // Kosongkan input jika salah
        document.getElementById("totalETH").textContent = "0.000000";
        return;
    } else if (betTimes > 99) {
        warning.textContent = "Maksimal 99x bet!";
        betTimesInput.value = 99;
    } else {
        warning.textContent = "";
    }

    updateTotalETH(betTimes);
}

function updateTotalETH() {
    let betTimes = parseInt(document.getElementById("betTimes").value) || 0;
    let totalETH = (betTimes * betPrice).toFixed(6); // Pastikan akurasi hingga 6 desimal
    document.getElementById("totalETH").textContent = totalETH;
}

// Pastikan fungsi ini dipanggil saat input berubah
document.getElementById("betTimes").addEventListener("input", updateTotalETH);

function updateTotalETH(betTimes) {
    if (isNaN(betTimes) || betTimes < 1 || betTimes > 99) {
        document.getElementById("totalETH").textContent = "0.000000";
        return;
    }
    let totalETH = (betTimes * 0.000175).toFixed(6); // Harga per bet 0.000175 ETH
    document.getElementById("totalETH").textContent = totalETH;
}

// Pastikan update saat input berubah
document.getElementById("betTimes").addEventListener("input", validateBetTimes);

function updateTotalETH(betTimes) {
    let totalETH = (betTimes * betPrice).toFixed(6);
    document.getElementById("totalETH").textContent = totalETH;
}

// Pastikan update saat input berubah
document.getElementById("betTimes").addEventListener("input", validateBetTimes);

// Pastikan fungsi ini dipanggil saat input berubah
document.getElementById("betTimes").addEventListener("input", updateTotalETH);

// Search Data Result
document.addEventListener("DOMContentLoaded", function () {
    // Buat elemen pencarian
    const searchContainer = document.createElement("div");
    searchContainer.style.marginBottom = "10px";
    searchContainer.innerHTML = `
        <input type="text" id="searchInput" placeholder="Search Player, Tx, Bet Number..." oninput="searchHistory()">
        <button id="searchButton" onclick="clearSearch()">‚ùå Clear</button>
    `;

    // Sisipkan pencarian sebelum betHistory
    const betHistoryDiv = document.getElementById("betHistory");
    betHistoryDiv.parentNode.insertBefore(searchContainer, betHistoryDiv);

    // Tambahkan elemen "No results found" (disembunyikan dulu)
    const noResults = document.createElement("p");
    noResults.id = "noResults";
    noResults.style.color = "red";
    noResults.style.display = "none";
    noResults.innerText = "No results found.";
    betHistoryDiv.appendChild(noResults);
});

function searchHistory() {
    const searchTerm = document.getElementById("searchInput").value.trim().toLowerCase();
    const betHistory = document.getElementById("betHistory");
    const items = betHistory.getElementsByTagName("p"); // Ambil semua elemen <p>

    let found = false;

    for (let i = 0; i < items.length; i++) {
        const text = items[i].textContent.toLowerCase(); 

        // Gunakan includes() untuk pencarian umum, regex hanya jika perlu
        if (text.includes(searchTerm)) { 
            items[i].style.display = "";
            found = true;
        } else {
            items[i].style.display = "none";
        }
    }

    // Tampilkan atau sembunyikan pesan "No results found"
    document.getElementById("noResults").style.display = found ? "none" : "block";
}

function clearSearch() {
    document.getElementById("searchInput").value = "";
    const betHistory = document.getElementById("betHistory");
    const items = betHistory.getElementsByTagName("p");

    for (let i = 0; i < items.length; i++) {
        items[i].style.display = "";
    }

    // Sembunyikan pesan "No results found"
    document.getElementById("noResults").style.display = "none";
}

        async function loadBetHistory() {
    const bets = await contract.methods.getAllBets().call();
    let betList = "";
    for (let i = bets.length - 1; i >= 0; i--) { // Membalik urutan iterasi
        const bet = bets[i];
        const timestamp = new Date(bet.timestamp * 1000).toISOString().replace("T", " ").replace("Z", " UTC");
        const blockLink = `https://sepolia.basescan.org/block/${bet.blockNumber}`;
        const status = bet.txHash 
        ? '<span style="color: green;">Confirmed</span>' 
        : '<span style="color: red;">Pending</span>';
        const shortPlayer = bet.player ? `${bet.player.slice(0, 10)}...${bet.player.slice(-10)}` : "Unknown";
        const shortTx = bet.txHash ? `${bet.txHash.slice(0, 10)}...${bet.txHash.slice(-10)}` : "Pending";

        betList += `<p>
            Player: ${shortPlayer}<br> 
            BetNumber: <span style="color: orange;">${bet.number}</span><br> 
            BetAmount: <span style="color: orange;">${bet.betAmount}</span><br>
            TX: ${shortTx}<br> 
            Block: <a href="${blockLink}" target="_blank">${bet.blockNumber}</a><br>
            Status: ${status}<br>
            Time: <span style="color: #8e44ad;">${timestamp}</span><br>
        </p><hr>`;
        }
         document.getElementById("betHistory").innerHTML = betList;
            }

        async function loadUserBets() {
    const accounts = await web3.eth.getAccounts();
    const bets = await contract.methods.getUserBets(accounts[0]).call();
    let betList = "";
    for (let i = bets.length - 1; i >= 0; i--) { // Membalik urutan iterasi
        const bet = bets[i];
        const timestamp = new Date(bet.timestamp * 1000).toISOString().replace("T", " ").replace("Z", " UTC");
        const blockLink = `https://sepolia.basescan.org/block/${bet.blockNumber}`; // Ganti sesuai blockchain yang digunakan
        const status = bet.txHash 
        ? '<span style="color: green;">Confirmed</span>' 
        : '<span style="color: red;">Pending</span>'; // Jika belum ada blockNumber, berarti masih pending
        const shortPlayer = bet.player ? `${bet.player.slice(0, 10)}...${bet.player.slice(-10)}` : "Unknown"
        const shortTx = bet.txHash ? `${bet.txHash.slice(0, 10)}...${bet.txHash.slice(-10)}` : "Pending";

        betList += `<p>
            Player: ${shortPlayer}<br>
            BetNumber: <span style="color: orange;">${bet.number}</span><br> 
            BetAmount: <span style="color: orange;">${bet.betAmount}</span><br>
            TX: ${shortTx}<br> 
            Block: <a href="${blockLink}" target="_blank">${bet.blockNumber}</a><br>
            Status: ${status}<br>
            Time: <span style="color: #8e44ad;">${timestamp}</span><br>
        </p><hr>`;
    }
    document.getElementById("userBets").innerHTML = betList;
        }

        window.onload = init;
    </script>
</body>
</html>
