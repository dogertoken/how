<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taruhan Blockchain</title>
    <link rel="stylesheet" href="stylecss">
    <style>
        body {
    font-family: Arial, sans-serif;
    background-color: #f8f9fa;
    padding: 20px;
}

#app {
    max-width: 800px;
    margin: 0 auto;
}

h2 {
    margin-top: 30px;
}

button {
    margin-top: 10px;
    padding: 10px 20px;
    background-color: #28a745;
    color: white;
    border: none;
    cursor: pointer;
}

button:hover {
    background-color: #218838;
}

input {
    padding: 8px;
    margin-top: 10px;
    width: 100%;
    box-sizing: border-box;
}

#betHistory, #explorerHistory {
    margin-top: 20px;
}
    </style>
</head>
<body>
    <div id="app">
        <!-- Wallet Connection -->
        <button id="connectWalletBtn">Connect Wallet</button>
        <button id="disconnectWalletBtn" style="display:none;">Disconnect Wallet</button>

        <h3>Wallet Information</h3>
        <p><strong>Alamat Wallet:</strong> <span id="walletAddress">-</span></p>
        <p><strong>Saldo ETH:</strong> <span id="ethBalance">-</span> ETH</p>
        <p><strong>Saldo USDT:</strong> <span id="usdtBalance">-</span> USDT</p>

        <!-- Taruhan Form -->
        <h2>Place Bet</h2>
        <div>
            <label for="betNumber">Nomor Taruhan:</label>
            <input type="number" id="betNumber" placeholder="Masukkan nomor taruhan">
        </div>
        <div>
            <label for="betCount">Jumlah Taruhan:</label>
            <input type="number" id="betCount" placeholder="Jumlah taruhan">
        </div>
        <div>
            <button id="placeBetBtn">Place Bet (0.0001 ETH / 0.5 USDT per taruhan)</button>
        </div>

        <!-- Riwayat Taruhan -->
        <h2>Riwayat Taruhan Pribadi</h2>
        <div id="betHistory"></div>

        <h2>Explorer Taruhan Umum</h2>
        <div id="explorerHistory"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.6.9/dist/ethers.umd.min.js"></script>
    <script src="https://unpkg.com/web3.js"></script>
    <script src="appjs"></script>
    <script>
        let currentAccount = null;
let provider, signer, contract;
const contractAddress = 'YOUR_CONTRACT_ADDRESS';  // Ganti dengan alamat kontrak Anda
const usdtAddress = 'USDT_CONTRACT_ADDRESS';  // Ganti dengan alamat kontrak USDT Anda
const betPriceETH = ethers.utils.parseEther("0.0001");  // 0.0001 ETH
const betPriceUSDT = 500000;  // 0.5 USDT = 500,000 wei

// ABI dari kontrak pintar Anda
const abi = [
    "function placeBet(uint256 number, uint256 betCount, uint256 betType, bool isUSDT) public payable",
    "function getBet(uint256 betId) public view returns (address, uint256, uint256, uint256, uint256, uint256, bool, uint256)",
    "function addComment(uint256 betId, string memory comment) public",
    "function addLike(uint256 betId) public",
    "function getBetCount() public view returns (uint256)",
    "function balanceOf(address account) public view returns (uint256)"  // Fungsi untuk cek saldo USDT
];

// Menghubungkan wallet dengan provider
async function connectWallet() {
    if (window.ethereum) {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        currentAccount = await signer.getAddress();
        contract = new ethers.Contract(contractAddress, abi, signer);

        document.getElementById("connectWalletBtn").style.display = "none";
        document.getElementById("disconnectWalletBtn").style.display = "block";
        document.getElementById("walletAddress").innerText = currentAccount;

        loadBalance();  // Memuat saldo ETH dan USDT setelah wallet terhubung
        loadBetHistory();
        loadExplorerHistory();
    } else {
        alert("Please install MetaMask to connect your wallet.");
    }
}

// Memutuskan koneksi wallet
function disconnectWallet() {
    currentAccount = null;
    provider = null;
    signer = null;
    contract = null;

    document.getElementById("connectWalletBtn").style.display = "block";
    document.getElementById("disconnectWalletBtn").style.display = "none";
    document.getElementById("walletAddress").innerText = "-";
    document.getElementById("ethBalance").innerText = "-";
    document.getElementById("usdtBalance").innerText = "-";
}

// Mengambil saldo ETH dan USDT
async function loadBalance() {
    if (!currentAccount) return;

    // Mendapatkan saldo ETH
    const ethBalance = await provider.getBalance(currentAccount);
    document.getElementById("ethBalance").innerText = ethers.utils.formatEther(ethBalance);

    // Mendapatkan saldo USDT
    const usdtContract = new ethers.Contract(usdtAddress, abi, provider);
    const usdtBalance = await usdtContract.balanceOf(currentAccount);
    document.getElementById("usdtBalance").innerText = ethers.utils.formatUnits(usdtBalance, 6);  // USDT biasanya memiliki 6 desimal
}

// Menangani form untuk taruhan
async function placeBet() {
    const betNumber = document.getElementById("betNumber").value;
    const betCount = document.getElementById("betCount").value;
    const isUSDT = false; // Ganti sesuai jenis taruhan

    if (!betNumber || !betCount || isNaN(betNumber) || isNaN(betCount)) {
        alert("Please enter a valid bet number and count.");
        return;
    }

    const betAmount = isUSDT ? betPriceUSDT * betCount : betPriceETH * betCount;

    try {
        const tx = await contract.placeBet(betNumber, betCount, 0, isUSDT, {
            value: betAmount
        });
        await tx.wait();
        alert("Bet placed successfully!");
        loadBalance();  // Perbarui saldo setelah taruhan berhasil
        loadBetHistory();  // Load riwayat bet pribadi setelah taruhan berhasil
    } catch (error) {
        console.error(error);
        alert("Error placing bet.");
    }
}

// Mengambil riwayat taruhan pribadi
async function loadBetHistory() {
    if (!currentAccount) return;

    try {
        const betCount = await contract.getBetCount();
        let historyHTML = '';
        for (let i = 1; i <= betCount; i++) {
            const bet = await contract.getBet(i);
            if (bet[0].toLowerCase() === currentAccount.toLowerCase()) {
                historyHTML += `<div>
                    <p>Bet ID: ${i} | Nomor: ${bet[2]} | Taruhan: ${bet[1]} | Payout: ${bet[4]}</p>
                    <button onclick="addComment(${i})">Add Comment</button>
                    <button onclick="addLike(${i})">Like</button>
                    <div id="comments-${i}"></div>
                </div>`;
            }
        }
        document.getElementById("betHistory").innerHTML = historyHTML;
    } catch (error) {
        console.error(error);
    }
}

// Mengambil riwayat taruhan umum
async function loadExplorerHistory() {
    try {
        const betCount = await contract.getBetCount();
        let historyHTML = '';
        for (let i = 1; i <= betCount; i++) {
            const bet = await contract.getBet(i);
            historyHTML += `<div>
                <p>Bet ID: ${i} | Nomor: ${bet[2]} | Taruhan: ${bet[1]} | Payout: ${bet[4]}</p>
                <button onclick="addComment(${i})">Add Comment</button>
                <button onclick="addLike(${i})">Like</button>
                <div id="comments-${i}"></div>
            </div>`;
        }
        document.getElementById("explorerHistory").innerHTML = historyHTML;
    } catch (error) {
        console.error(error);
    }
}

// Menambahkan komentar
async function addComment(betId) {
    const comment = prompt("Enter your comment:");
    if (comment) {
        try {
            const tx = await contract.addComment(betId, comment);
            await tx.wait();
            alert("Comment added!");
            loadExplorerHistory();  // Update riwayat taruhan umum
        } catch (error) {
            console.error(error);
            alert("Error adding comment.");
        }
    }
}

// Menambahkan like
async function addLike(betId) {
    try {
        const tx = await contract.addLike(betId);
        await tx.wait();
        alert("You liked this bet!");
        loadExplorerHistory();  // Update riwayat taruhan umum
    } catch (error) {
        console.error(error);
        alert("Error adding like.");
    }
}

// Event listener untuk tombol
document.getElementById("connectWalletBtn").addEventListener("click", connectWallet);
document.getElementById("disconnectWalletBtn").addEventListener("click", disconnectWallet);
document.getElementById("placeBetBtn").addEventListener("click", placeBet);
    </script>
</body>
</html>
