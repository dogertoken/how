<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taruhan Blockchain</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* ðŸ”¹ Global Styles */
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1e1e2f, #282843);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        #app {
            max-width: 950px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            text-align: center;
            width: 100%;
            box-sizing: border-box;
        }

        /* Responsif untuk layar lebih kecil */
        @media (max-width: 768px) {
            #app {
                max-width: 100%;
                padding: 15px;
            }

            body {
                padding: 10px;
            }
        }

        /* Responsif untuk layar lebih besar */
        @media (min-width: 1200px) {
            #app {
                max-width: 950px;
                padding: 30px;
            }
        }

        /* ðŸ”¹ Header */
        h2 {
            font-size: 24px;
            margin-bottom: 15px;
            letter-spacing: 1px;
        }

        /* ðŸ”¹ Input Fields */
        input {
            padding: 10px;
            margin-top: 10px;
            width: 100%;
            box-sizing: border-box;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 16px;
            text-align: center;
            transition: 0.3s;
        }

        input:focus {
            outline: none;
            box-shadow: 0 0 10px #00ffcc;
            background: rgba(255, 255, 255, 0.3);
        }

        /* ðŸ”¹ Button Styling */
        button {
            margin-top: 15px;
            padding: 12px 25px;
            background: linear-gradient(135deg, #00ffcc, #007bff);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: 0.3s;
            box-shadow: 0 4px 8px rgba(0, 255, 204, 0.3);
            position: relative;
            overflow: hidden;
        }

        button:hover {
            background: linear-gradient(135deg, #007bff, #00ffcc);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 255, 204, 0.5);
        }

        /* ðŸ”¹ Button Click Animation */
        button:active {
            transform: translateY(2px);
        }

        /* ðŸ”¹ Bet History Section */
        #betHistory, #explorerHistory {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            box-shadow: 0px 3px 8px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(5px);
        }

        #betHistory p, #explorerHistory p {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Modal Style */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4); 
            padding-top: 60px;
        }

        .modal-content {
            background-color: #1e1e2f;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 10px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Wallet Connection -->
        <button id="connectWalletBtn">Connect Wallet</button>
        <button id="disconnectWalletBtn" style="display:none;">Disconnect Wallet</button>

        <h3>Wallet Information</h3>
        <p><strong>Alamat Wallet:</strong> <span id="walletAddress">-</span></p>
        <p><strong>Saldo ETH:</strong> <span id="ethBalance">-</span> ETH</p>
        <p><strong>Saldo USDT:</strong> <span id="usdtBalance">-</span> USDT</p>

        <!-- Taruhan Form -->
        <h2>Place Bet</h2>
        <button id="placeBetBtn">Pasang Taruhan</button>

        <!-- Modal Popup -->
        <div id="betModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3>Masukkan Detail Taruhan</h3>
                <div>
                    <label for="betNumber">Nomor Taruhan:</label>
                    <input type="number" id="betNumber" placeholder="Masukkan nomor taruhan" min="0" max="9999">
                </div>
                <div>
                    <label for="betCount">Jumlah Taruhan:</label>
                    <input type="number" id="betCount" placeholder="Jumlah taruhan" min="1" max="99">
                </div>
                <button id="calculatePriceBtn">Kalkulasi Harga</button>
                
                <!-- Opsi Pembayaran -->
                <div id="paymentOptions" style="display: none; margin-top: 10px;">
                    <label for="paymentMethod">Pilih Pembayaran:</label>
                    <select id="paymentMethod">
                        <option value="eth">ETH</option>
                        <option value="usdt">USDT</option>
                    </select>
                </div>

                <div id="priceDetails" style="margin-top: 10px; display: none;">
                    <p><strong>Total Biaya: </strong><span id="totalPrice">0</span> <span id="currencyType">ETH</span></p>
                </div>
                <button id="confirmBetBtn" style="display: none;">Konfirmasi Pembayaran</button>
            </div>
        </div>

        <!-- Riwayat Taruhan -->
        <h2>Riwayat Taruhan Pribadi</h2>
        <div id="betHistory"></div>

        <h2>Explorer Taruhan Umum</h2>
        <div id="explorerHistory"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.6.9/dist/ethers.umd.min.js"></script>
    <script src="https://unpkg.com/web3.js"></script>
    <script src="app.js"></script>

    <script>
        let currentAccount = null;
        let provider, signer, contract;
        const contractAddress = 'YOUR_CONTRACT_ADDRESS';  // Ganti dengan alamat kontrak Anda
        const usdtAddress = 'USDT_CONTRACT_ADDRESS';  // Ganti dengan alamat kontrak USDT Anda
        const betPriceETH = ethers.utils.parseEther("0.0001");  // 0.0001 ETH
        const betPriceUSDT = 500000;  // 0.5 USDT = 500,000 wei

        // ABI dari kontrak pintar Anda
        const abi = [
            "function placeBet(uint256 number, uint256 betCount, uint256 betType, bool isUSDT) public payable",
            "function getBet(uint256 betId) public view returns (address, uint256, uint256, uint256, uint256, uint256, bool, uint256)",
            "function addComment(uint256 betId, string memory comment) public",
            "function addLike(uint256 betId) public",
            "function getBetCount() public view returns (uint256)",
            "function balanceOf(address account) public view returns (uint256)"  // Fungsi untuk memeriksa saldo USDT
        ];

        // Inisialisasi Web3.js dan Ethers.js
        async function initialize() {
            if (typeof window.ethereum !== 'undefined') {
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                contract = new ethers.Contract(contractAddress, abi, signer);
                await getWalletDetails();
            }
        }

        // Fungsi untuk menghubungkan dompet dan mendapatkan detailnya
        async function getWalletDetails() {
            const accounts = await provider.listAccounts();
            if (accounts.length > 0) {
                currentAccount = accounts[0];
                document.getElementById("walletAddress").innerText = currentAccount;
                await getEthBalance();
                await getUsdtBalance();
            }
        }

        // Fungsi untuk mengambil saldo ETH
        async function getEthBalance() {
            const balance = await provider.getBalance(currentAccount);
            document.getElementById("ethBalance").innerText = ethers.utils.formatEther(balance);
        }

        // Fungsi untuk mengambil saldo USDT
        async function getUsdtBalance() {
            const usdtContract = new ethers.Contract(usdtAddress, ["function balanceOf(address) view returns (uint256)"], provider);
            const balance = await usdtContract.balanceOf(currentAccount);
            document.getElementById("usdtBalance").innerText = ethers.utils.formatUnits(balance, 6);
        }

        // Fungsi untuk memasang taruhan
        async function placeBet() {
            const betNumber = document.getElementById('betNumber').value;
            const betCount = document.getElementById('betCount').value;
            const paymentMethod = document.getElementById('paymentMethod').value;
            let price, isUSDT;

            // Validasi input
            if (!betNumber || !betCount) {
                alert("Harap isi nomor taruhan dan jumlah taruhan.");
                return;
            }

            if (paymentMethod === 'eth') {
                price = betPriceETH.mul(betCount);
                isUSDT = false;
            } else {
                price = betPriceUSDT * betCount;
                isUSDT = true;
            }

            // Kirim transaksi ke kontrak pintar
            try {
                let tx;
                if (isUSDT) {
                    const usdtContract = new ethers.Contract(usdtAddress, abi, signer);
                    tx = await usdtContract.transfer(contractAddress, price, { from: currentAccount });
                } else {
                    tx = await contract.placeBet(betNumber, betCount, 1, false, {
                        value: price,
                    });
                }
                await tx.wait();
                alert("Taruhan berhasil!");
            } catch (error) {
                console.error(error);
                alert("Terjadi kesalahan saat memasang taruhan.");
            }
        }

        // Fungsi untuk membuka modal
        document.getElementById('placeBetBtn').addEventListener('click', function() {
            document.getElementById('betModal').style.display = "block";
        });

        // Fungsi untuk menutup modal
        document.querySelector('.close').addEventListener('click', function() {
            document.getElementById('betModal').style.display = "none";
        });

        // Fungsi untuk menghitung harga taruhan dan menampilkan detailnya
        document.getElementById('calculatePriceBtn').addEventListener('click', function() {
            const betCount = document.getElementById('betCount').value;
            const paymentMethod = document.getElementById('paymentMethod').value;
            let price, currencyType;

            if (!betCount) {
                alert("Harap masukkan jumlah taruhan.");
                return;
            }

            if (paymentMethod === 'eth') {
                price = betPriceETH.mul(betCount);
                currencyType = 'ETH';
            } else {
                price = betPriceUSDT * betCount;
                currencyType = 'USDT';
            }

            document.getElementById('totalPrice').innerText = price.toString();
            document.getElementById('currencyType').innerText = currencyType;
            document.getElementById('priceDetails').style.display = "block";
            document.getElementById('paymentOptions').style.display = "block";
            document.getElementById('confirmBetBtn').style.display = "inline-block";
        });

        // Fungsi untuk konfirmasi taruhan
        document.getElementById('confirmBetBtn').addEventListener('click', function() {
            placeBet();
        });

        // Menjalankan inisialisasi saat halaman dimuat
        window.onload = initialize;
    </script>
</body>
</html>
